CMAKE_MINIMUM_REQUIRED(VERSION 3.25 FATAL_ERROR)
PROJECT(FleetHttpClient CXX)

SET(CMAKE_BUILD_RPATH_USE_ORIGIN ON)

SET(CMAKE_CXX_STANDARD 20)
SET(CMAKE_CXX_EXTENSIONS OFF)   # For increased portability

INCLUDE(CheckPIESupported)
CHECK_PIE_SUPPORTED()
SET(CMAKE_POSITION_INDEPENDENT_CODE ON)

SET(FLEET_HTTP_CLIENT_VERSION 1.0.0)

ADD_SUBDIRECTORY("lib/Cpp-rest-openapi-client")

FILE(GLOB_RECURSE SOURCES "src/*")
ADD_LIBRARY(fleet_http_client STATIC ${SOURCES})
TARGET_INCLUDE_DIRECTORIES(fleet_http_client PUBLIC ${CMAKE_CURRENT_LIST_DIR}/include)
TARGET_LINK_LIBRARIES(fleet_http_client PUBLIC CppRestOpenAPIClient)

OPTION(BRINGAUTO_TESTS "Enable tests" OFF)
OPTION(BRINGAUTO_SAMPLES OFF)

IF(BRINGAUTO_TESTS)
    ENABLE_TESTING()
    INCLUDE(${CMAKE_CURRENT_SOURCE_DIR}/test/CMakeLists.txt)
ENDIF(BRINGAUTO_TESTS)

IF(BRINGAUTO_SAMPLES)
    ADD_SUBDIRECTORY(${CMAKE_CURRENT_SOURCE_DIR}/example/)
ENDIF()